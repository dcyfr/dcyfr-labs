# Dependabot Configuration
# Automated dependency updates and security alerts
# Docs: https://docs.github.com/en/code-security/dependabot
# Auto-merge: .github/workflows/dependabot-auto-merge.yml
# 
# IMPORTANT: Repository settings must enable auto-merge:
# Settings → Pull requests → Allow auto-merge ✓

version: 2

# Note: We don't define a top-level `registries` entry for the public npm registry
# Dependabot's `registries` top-level key is intended for private registries and
# requires authentication fields (token or username/password). Defining the
# public npm registry here can trigger schema validation errors.
    
updates:
  # npm dependencies - weekly batch updates
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/Los_Angeles"
    
    # Grouping strategy - reduces PR noise by combining related updates
    groups:
      # Framework core - Next.js, React, and Vercel integrations
      nextjs-core:
        patterns:
          - "next"
          - "react"
          - "react-dom"
          - "@next/*"
          - "@vercel/analytics"
          - "@vercel/speed-insights"
          - "@vercel/og"
        update-types:
          - "minor"
          - "patch"
      
      # Development tooling - linters, testers, type checkers
      dev-tools:
        dependency-type: "development"
        update-types:
          - "minor"
          - "patch"
        exclude-patterns:
          - "@types/*"  # Separate group for types
      
      # TypeScript ecosystem - compiler and type definitions
      typescript-stack:
        patterns:
          - "typescript"
          - "@types/*"
          - "ts-node"
      
      # Testing infrastructure - Vitest, Playwright, Testing Library
      testing-stack:
        patterns:
          - "vitest"
          - "@vitest/*"
          - "@testing-library/*"
          - "playwright"
          - "@playwright/*"
          - "@axe-core/*"
      
      # Code quality - ESLint, Prettier, and related configs
      linting-formatting:
        patterns:
          - "eslint"
          - "eslint-*"
          - "@eslint/*"
          - "prettier"
          - "@typescript-eslint/*"
      
      # UI framework - Tailwind, Radix UI, and styling utilities
      ui-framework:
        patterns:
          - "tailwindcss"
          - "@tailwindcss/*"
          - "tailwindcss-animate"
          - "@radix-ui/*"
          - "class-variance-authority"
          - "clsx"
          - "tailwind-merge"
          - "framer-motion"
          - "lucide-react"
      
      # Content processing - MDX, syntax highlighting, rehype/remark plugins
      content-pipeline:
        patterns:
          - "next-mdx-remote"
          - "gray-matter"
          - "shiki"
          - "rehype-*"
          - "remark-*"
          - "unified"
          - "unist-*"
          - "hast-*"
          - "katex"
          - "mermaid"
      
      # Monitoring & observability - Sentry error tracking
      monitoring:
        patterns:
          - "@sentry/*"
      
      # Background jobs - Inngest task processing
      background-jobs:
        patterns:
          - "inngest"
      
      # Email & communication - Resend and email templates
      email:
        patterns:
          - "resend"
          - "@react-email/*"
    
    # Commit message prefix for conventional commits
    commit-message:
      prefix: "chore(deps)"
      prefix-development: "chore(deps-dev)"
      include: "scope"
    
    # Labels applied to all PRs
    labels:
      - "dependencies"
    
    # Ignore specific packages (add as needed)
    # ignore:
    #   - dependency-name: "package-name"
    #     versions: ["x.x.x"]
    
    # Auto-merge configuration (requires GitHub auto-merge enabled)
    # Workflow handles security checks - this is just a fallback for simple patches
    allow:
      - dependency-type: "development"
      - dependency-type: "production"
    
    # Increase PR limit slightly for production patches
    open-pull-requests-limit: 15
    
    # Rebase stale PRs to ensure latest base
    rebase-strategy: "auto"
    
    # Pull request versioning (keep PR titles consistent)
    pull-request-branch-name:
      separator: "/"
  
  # Node.js Runtime Tracking (.nvmrc in place as of Feb 7, 2026)
  # - .nvmrc files: workspace root + dcyfr-labs (v24.13.0)
  # - Manual updates required: Dependabot does not auto-update Node.js runtime versions
  # - Security patches: Monitor nodejs-sec mailing list + DEPENDABOT_SECURITY_AUDIT_JAN2026.md
  # - Verification: nvm use && node --version (should show v24.13.0)
  # - Update process: Manual .nvmrc edit → npm run ai:sync → test → commit
  
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "09:00"
      timezone: "America/Los_Angeles"
    commit-message:
      prefix: "chore(ci)"
    labels:
      - "ci/cd"
      - "dependencies"
    # Auto-merge GitHub Actions updates (low risk)
    allow:
      - dependency-type: "all"
    rebase-strategy: "auto"
    open-pull-requests-limit: 20


