name: AI Instructions Sync & Validation

on:
  push:
    branches: [ 'main', 'preview' ]
  pull_request:
    branches: [ 'main', 'preview' ]

jobs:
  sync-and-validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Sync AI docs
        run: npm run sync:ai

      - name: Validate instruction files
        run: node scripts/validate-instructions.mjs

      - name: Optional: Validate MCP servers (non-strict)
        run: |
          if [ -f scripts/check-mcp-servers.mjs ]; then
            node scripts/check-mcp-servers.mjs --no-auth || echo "MCP checks failed but continuing";
          else
            echo "No MCP script found, proceeding...";
          fi
