{
  // ============================================
  // OPENCODE.AI CONFIGURATION
  // ============================================
  // Schema validation - enables editor autocomplete
  "$schema": "https://opencode.ai/config.json",

  // ============================================
  // MODEL & PROVIDER CONFIGURATION
  // ============================================

  // Primary model for feature work
  // Can be overridden via: OPENCODE_MODEL environment variable
  "model": "{env:OPENCODE_MODEL:anthropic/claude-sonnet-4-5}",

  // Lightweight model for quick tasks (title generation, summaries)
  // Can be overridden via: OPENCODE_SMALL_MODEL environment variable
  "small_model": "{env:OPENCODE_SMALL_MODEL:anthropic/claude-haiku-4-5}",

  // Provider-specific configuration
  "provider": {
    // Anthropic (Claude) configuration
    "anthropic": {
      "options": {
        // API key from environment - NEVER hardcode!
        "apiKey": "{env:ANTHROPIC_API_KEY}",
        // Request timeout in milliseconds
        "timeout": "{env:OPENCODE_TIMEOUT:600000}",
        // Ensure cache key is set for prompt caching
        "setCacheKey": true,
      },
    },
    // GitHub Copilot configuration (device code auth)
    "github-copilot": {
      "options": {
        // Device code flow - no API key needed
        "timeout": 10000,
      },
    },
  },

  // Restrict to specific providers (security best practice)
  // Only enable providers your team actively uses
  "enabled_providers": ["anthropic", "github-copilot"],

  // Explicitly disable providers to prevent accidental use
  // Even if credentials are configured
  "disabled_providers": ["groq", "openai"],

  // ============================================
  // INSTRUCTIONS & RULES
  // ============================================

  // Instruction files loaded into model context
  // Supports glob patterns and variable substitution
  "instructions": [
    // DCYFR-specific enforcement rules
    "{file:.opencode/DCYFR.opencode.md}",
    ".github/agents/DCYFR.agent.md",

    // Pattern documentation
    ".github/agents/patterns/*.md",

    // Enforcement rules
    ".github/agents/enforcement/*.md",

    // Quick reference for common tasks
    "docs/ai/quick-reference.md",

    // Custom instructions via environment (optional)
    "{env:CUSTOM_INSTRUCTIONS}",
  ],

  // ============================================
  // MCP SERVER CONFIGURATION
  // ============================================

  "mcp": {
    // ---- LOCAL MCP SERVERS ----

    // Memory server - persistent data storage across sessions
    "memory": {
      "type": "local",
      "command": ["npx", "@modelcontextprotocol/server-memory"],
      "enabled": true,
      "timeout": 5000,
      "autoRestart": true,
      "description": "Persistent memory for session state and context",
    },

    // Filesystem server - read/write access to project files
    "filesystem": {
      "type": "local",
      "command": [
        "npx",
        "@modelcontextprotocol/server-filesystem",
        "./",
      ],
      "enabled": true,
      "timeout": 5000,
      "autoRestart": true,
      "description": "File operations within project directory",
    },

    // ---- REMOTE MCP SERVERS ----

    // GitHub API access (disabled by default - enable if needed)
    "github": {
      "type": "remote",
      "url": "https://api.githubcopilot.com/mcp/",
      "enabled": false,
      "timeout": 10000,
      "auth": {
        "type": "bearer",
        "token": "{env:GITHUB_MCP_TOKEN}",
      },
      "description": "GitHub repository operations and API access",
    },

    // Context7 - library documentation and code examples
    "context7": {
      "type": "remote",
      "url": "https://mcp.context7.com/mcp",
      "enabled": true,
      "timeout": 5000,
      "description": "Library documentation resolution (npm, PyPI, etc.)",
    },

    // Octocode - GitHub repository code research
    "octocode": {
      "type": "local",
      "command": ["npx", "octocode-mcp@latest"],
      "enabled": true,
      "timeout": 5000,
      "autoRestart": true,
      "description": "Search and analyze code across GitHub repositories",
    },

    // Perplexity - web search and research
    "perplexity": {
      "type": "local",
      "command": ["npx", "-y", "@perplexity-ai/mcp-server"],
      "enabled": true,
      "environment": {
        "PERPLEXITY_API_KEY": "{env:PERPLEXITY_API_KEY}",
      },
      "timeout": 5000,
      "autoRestart": true,
      "description": "Web search and research capability",
    },

    // Vercel - deployment and project management
    "vercel": {
      "type": "remote",
      "url": "https://mcp.vercel.com",
      "enabled": false,
      "timeout": 5000,
      "auth": {
        "type": "bearer",
        "token": "{env:VERCEL_MCP_TOKEN}",
      },
      "description": "Vercel deployment and project operations",
    },

    // Sentry - error tracking integration
    "sentry": {
      "type": "remote",
      "url": "https://mcp.sentry.dev/mcp",
      "enabled": false,
      "timeout": 5000,
      "oauth": {},
      "description": "Sentry error tracking and issue management",
    },

    // Axiom - logging and observability
    "axiom": {
      "type": "local",
      "command": ["npx", "-y", "mcp-remote", "https://mcp.axiom.co/mcp"],
      "enabled": true,
      "timeout": 5000,
      "autoRestart": true,
      "description": "Axiom logging and data analytics",
    },

    // Deep Graph - Next.js repository analysis
    "deepgraph_nextjs": {
      "type": "local",
      "command": ["npx", "-y", "mcp-code-graph@latest", "vercel/next.js"],
      "enabled": false,
      "timeout": 10000,
      "description": "Next.js repository code graph analysis",
    },

    // Deep Graph - TypeScript repository analysis
    "deepgraph_typescript": {
      "type": "local",
      "command": ["npx", "-y", "mcp-code-graph@latest", "microsoft/TypeScript"],
      "enabled": false,
      "timeout": 10000,
      "description": "TypeScript repository code graph analysis",
    },

    // Playwright - web automation (disabled - use local extension instead)
    "playwright": {
      "type": "local",
      "command": ["npx", "-y", "@executeautomation/playwright-mcp-server"],
      "enabled": false,
      "timeout": 5000,
      "description": "Web automation and testing",
    },

    // Chrome DevTools - browser debugging
    "chrome_devtools": {
      "type": "local",
      "command": ["npx", "-y", "chrome-devtools-mcp@latest"],
      "enabled": false,
      "timeout": 5000,
      "description": "Chrome DevTools protocol access",
    },

    // arXiv - research paper access
    "arxiv": {
      "type": "local",
      "command": ["uvx", "arxiv-mcp-server"],
      "enabled": false,
      "timeout": 5000,
      "description": "arXiv research paper search and retrieval",
    },
  },

  // ============================================
  // TOOL PERMISSIONS
  // ============================================

  // Fine-grained permission control for tools
  // Values: "allow" | "ask" | "disable"
  "tools": {
    // Default: allow all tools
    "*": true,
    // Specific tool controls
    "memory_*": true,
    "filesystem_*": true,
    "github_*": false,
    "context7_*": true,
    "octocode_*": true,
    "perplexity_*": true,
    "vercel_*": false,
    "sentry_*": false,
    "axiom_*": false,
    "deepgraph_nextjs_*": false,
    "deepgraph_typescript_*": false,
    "playwright_*": false,
    "chrome_devtools_*": false,
    "arxiv_*": false,
  },

  // ============================================
  // AGENT CONFIGURATION
  // ============================================

  "agent": {
    // Default agent configuration
    "default": {
      "tools": {
        "*": true,
        "github_*": false,
        "sentry_*": false,
        "axiom_*": false,
      },
      "permission": {
        "skill": {
          "*": "allow",
          "dcyfr-*": "allow",
          "experimental-*": "ask",
        },
      },
      "description": "Default agent for general tasks",
    },

    // Feature implementation agent
    // Full access to filesystem and memory for comprehensive development
    "dcyfr-feature": {
      "tools": {
        "*": true,
        "filesystem_*": true,
        "memory_*": true,
      },
      "permission": {
        "skill": {
          "dcyfr-*": "allow",
        },
      },
      "description": "Full feature implementation with design token enforcement",
    },

    // Quick fix agent
    // Optimized for fast, focused changes
    "dcyfr-quick": {
      "tools": {
        "*": true,
        "filesystem_*": true,
      },
      "permission": {
        "skill": {
          "dcyfr-quick-fix": "allow",
        },
      },
      "description": "Fast compliance fixes and pattern validation",
    },

    // Analytics agent
    // Redis operations and analytics data analysis
    "dcyfr-analytics": {
      "tools": {
        "*": true,
        "filesystem_*": true,
        "memory_*": true,
      },
      "permission": {
        "skill": {
          "dcyfr-*": "allow",
        },
      },
      "description": "Analytics data analysis and Redis operations",
    },

    // Design token agent
    // Token validation and compliance checking
    "dcyfr-tokens": {
      "tools": {
        "*": true,
        "filesystem_*": true,
        "memory_*": true,
      },
      "permission": {
        "skill": {
          "dcyfr-design-tokens": "allow",
          "dcyfr-*": "allow",
        },
      },
      "description": "Design token validation and compliance",
    },

    // Content management agent
    // Blog and MDX content operations
    "dcyfr-content": {
      "tools": {
        "*": true,
        "filesystem_*": true,
        "memory_*": true,
      },
      "permission": {
        "skill": {
          "dcyfr-mdx-authoring": "allow",
          "dcyfr-*": "allow",
        },
      },
      "description": "Blog and content management with MDX authoring",
    },
  },

  // ============================================
  // CONTEXT & TOKEN MANAGEMENT
  // ============================================

  // Automatic context compaction when approaching token limits
  "compaction": {
    // Auto-compact when context is full
    "auto": true,
    // Remove old tool outputs to save tokens
    "prune": true,
    // Compact at 80% of token limit to avoid hitting limits
    "pruneThreshold": 0.8,
  },

  // ============================================
  // FILE WATCHER CONFIGURATION
  // ============================================

  // Exclude noisy directories from file watching
  // Improves performance and reduces irrelevant context
  "watcher": {
    "ignore": [
      // Node.js dependencies
      "node_modules/**",
      // Build output
      "dist/**",
      ".next/**",
      ".vercel/**",
      // Version control
      ".git/**",
      // Test/coverage reports
      "reports/**",
      "coverage/**",
      // Public static assets
      "public/**",
      // OpenCode session data (exclude to avoid feedback loops)
      ".opencode/.session-log.jsonl",
      ".session-state.json",
    ],
  },

  // ============================================
  // FORMATTERS
  // ============================================

  // Code formatter configuration
  "formatter": {
    // Prettier - default formatter
    "prettier": {
      "disabled": false,
    },
    // ESLint - linting and auto-fix
    "eslint": {
      "command": ["npx", "eslint", "--fix", "$FILE"],
      "extensions": [".js", ".ts", ".jsx", ".tsx"],
      "environment": {
        "NODE_ENV": "development",
      },
    },
  },

  // ============================================
  // USER INTERFACE & THEME
  // ============================================

  // Terminal UI theme
  "theme": "opencode",

  // TUI-specific settings
  "tui": {
    // Scroll speed multiplier (higher = faster)
    "scroll_speed": 3,
    // macOS-style scroll acceleration
    "scroll_acceleration": {
      "enabled": true,
    },
    // Diff rendering: "auto" (adapts to width) or "stacked"
    "diff_style": "auto",
  },

  // ============================================
  // AUTO-UPDATE & MAINTENANCE
  // ============================================

  // Auto-update OpenCode when new versions available
  "autoupdate": true,

  // ============================================
  // SHARING & COLLABORATION
  // ============================================

  // Share mode: "manual" | "auto" | "disabled"
  // "manual" requires explicit /share command
  "share": "manual",
}
