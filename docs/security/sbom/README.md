<!-- TLP:CLEAR -->

# Software Bill of Materials (SBOM)

**Purpose:** Third-party risk management for SOC2 Type 2 compliance
**Owner:** Security Team
**Last Updated:** 2026-01-31
**Retention:** 24 months (SOC2 Type 2 requirement)

---

## Overview

This directory contains Software Bill of Materials (SBOMs) for dcyfr-labs, generated in multiple industry-standard formats to support SOC2 Type 2 compliance requirements for third-party risk management and vulnerability tracking.

### What is an SBOM?

A Software Bill of Materials is a comprehensive inventory of all components, dependencies, and third-party services used in an application. It serves as a critical security control by:

- **Enabling vulnerability management** - Quickly identify affected components when CVEs are disclosed
- **Supporting supply chain security** - Track all dependencies and their sources
- **Meeting compliance requirements** - SOC2 Type 2 requires documented third-party risk management
- **Facilitating incident response** - Rapid identification of vulnerable components during security events

---

## File Formats

### CycloneDX (Primary)

**Files:** `sbom-cyclonedx-YYYY-MM-DD.json`
**Spec Version:** 1.5
**Purpose:** Industry-standard SBOM format with rich metadata

**Generated by:** `@cyclonedx/cyclonedx-npm`
**Use case:** Automated vulnerability scanning, dependency analysis

### SPDX

**Files:** `sbom-spdx-YYYY-MM-DD.json`
**Spec Version:** 2.3
**Purpose:** Linux Foundation standard for software package data exchange

**Generated by:** Custom script
**Use case:** License compliance, legal reviews

### Combined Enriched

**Files:** `sbom-combined-YYYY-MM-DD.json`
**Format:** Custom JSON
**Purpose:** Comprehensive inventory including third-party services and MCP servers

**Contains:**
- All npm dependencies (runtime + dev)
- Third-party services (Vercel, Redis, Sentry, etc.)
- Internal packages (@dcyfr/ai, @dcyfr/agents)
- MCP server integrations
- Vulnerability summary
- SOC2 compliance metadata

---

## Generation

### Manual Generation

```bash
# Generate all SBOM formats
npm run sbom:generate

# Or run the script directly
node scripts/security/generate-sbom.mjs
```

### Automated Generation

SBOMs are automatically generated:
- **On release:** When version tags are created
- **Monthly:** 1st day of each month at 2 AM UTC
- **On demand:** Manual workflow trigger

**GitHub Action:** `.github/workflows/sbom-generation.yml`

---

## Contents

### npm Dependencies

**Total:** 110 packages (72 runtime + 38 dev)

**Runtime Dependencies (72):**
- Framework: Next.js 16, React 19, TypeScript
- UI: Tailwind v4, Radix UI, Framer Motion
- Content: MDX pipeline, Shiki syntax highlighting
- Analytics: Vercel Analytics, Axiom logging
- External services: Inngest, Resend, Sentry

**Dev Dependencies (38):**
- Testing: Vitest, Playwright, MSW
- Linting: ESLint, TypeScript compiler
- Security: CodeQL, Semgrep, Nuclei
- Build tools: Next.js bundle analyzer

### Third-Party Services (12)

| Service | Criticality | Purpose | SOC2 Report |
|---------|-------------|---------|-------------|
| GitHub API | Critical | Version control, CI/CD | [Available](https://github.com/security) |
| Upstash Redis | Critical | Caching, analytics | On request |
| Vercel | Critical | Hosting, deployment | [Available](https://vercel.com/security) |
| Inngest | Critical | Background jobs | [Available](https://www.inngest.com/security) |
| Sentry | Standard | Error tracking | [Available](https://sentry.io/security) |
| Resend | Standard | Email delivery | On request |
| Perplexity AI | Standard | AI research | Not available |
| GreyNoise | Standard | IP reputation | On request |
| Google Indexing | Low | Search indexing | [Available](https://cloud.google.com/security/compliance) |
| Giscus | Low | Comments | Via GitHub |
| Inoreader | Low | RSS feeds | Not available |
| Axiom | Standard | Log aggregation | [Available](https://axiom.co/security) |

### Internal Packages (2)

- `@dcyfr/ai` (v1.0.1) - AI utilities framework
- `@dcyfr/agents` (file:../dcyfr-ai-agents) - AI agents framework

### MCP Servers (6)

- GitHub (HTTP) - Code repository integration
- Vercel (HTTP) - Deployment management
- Sentry (HTTP) - Error tracking
- DCYFR Analytics (stdio) - Project analytics
- DCYFR DesignTokens (stdio) - Design token validation
- DCYFR ContentManager (stdio) - Content management

---

## Usage

### Vulnerability Scanning

```bash
# Check for vulnerabilities in dependencies
npm audit

# Generate SBOM and check for known CVEs
npm run sbom:generate
npm run sbom:validate

# Review combined SBOM for third-party service risks
cat docs/security/sbom/sbom-combined-$(date +%Y-%m-%d).json | jq '.thirdPartyServices'
```

### Compliance Audits

**Monthly Audit:** Review SBOM for changes
```bash
# Compare current SBOM to previous month
npm run sbom:compare
```

**Quarterly Audit:** Vendor risk assessment
```bash
# Extract third-party services for risk scoring
npm run sbom:vendors
```

**Annual Audit:** Comprehensive review
```bash
# Generate full compliance report
npm run sbom:compliance-report
```

---

## Retention Policy

**Duration:** 24 months
**Rationale:** SOC2 Type 2 requires 12 months observed + 12 months historical

**Cleanup:**
```bash
# Remove SBOMs older than 24 months
find docs/security/sbom -name "sbom-*.json" -mtime +730 -delete
```

**Storage:** Git version control + GitHub releases

---

## SOC2 Compliance Mapping

### Trust Service Criteria

| Criterion | Control | SBOM Role |
|-----------|---------|-----------|
| **SC3.2** | Security testing | Vulnerability identification |
| **PI1.1** | Data validation | Component verification |
| **C2.1** | Third-party inventory | Service catalog |
| **P5.1** | Vendor management | Risk assessment support |

### Evidence Collection

- **Monthly:** SBOM generation logs
- **Quarterly:** Vendor risk scores
- **Annual:** Compliance report

**Storage:** `docs/security/.private/evidence/YYYY-MM/`

---

## Troubleshooting

### SBOM Generation Fails

**Symptom:** Script exits with error code 1

**Diagnosis:**
```bash
# Check npm dependencies are installed
npm install

# Verify package.json and package-lock.json exist
ls -l package*.json

# Test CycloneDX tool
npx @cyclonedx/cyclonedx-npm --version
```

**Resolution:**
- Ensure all npm dependencies installed: `npm ci`
- Update CycloneDX tool: `npm update -g @cyclonedx/cyclonedx-npm`
- Check for corrupted package-lock.json: `rm package-lock.json && npm install`

### Missing Dependencies in SBOM

**Symptom:** Known dependencies not appearing in SBOM

**Diagnosis:**
```bash
# List all installed packages
npm ls --all

# Compare to SBOM
cat docs/security/sbom/sbom-combined-*.json | jq '.summary'
```

**Resolution:**
- Regenerate package-lock.json: `rm package-lock.json && npm install`
- Run SBOM generation with verbose logging: `DEBUG=* npm run sbom:generate`

### Third-Party Services Not Listed

**Symptom:** External service missing from combined SBOM

**Diagnosis:**
- Check `THIRD_PARTY_SERVICES` constant in `scripts/security/generate-sbom.mjs`

**Resolution:**
- Add missing service to the inventory
- Regenerate SBOM: `npm run sbom:generate`

---

## File Naming Convention

**Pattern:** `sbom-{format}-YYYY-MM-DD.{ext}`

**Examples:**
- `sbom-cyclonedx-2026-01-31.json`
- `sbom-spdx-2026-01-31.json`
- `sbom-combined-2026-01-31.json`
- `sbom-summary-2026-01-31.md`

**Rationale:** Date-based naming enables:
- Historical comparison
- Automated cleanup (retention policy)
- Audit trail for compliance

---

## Integration

### CI/CD Pipeline

**GitHub Actions:**
- Automated generation on release tags
- Monthly scheduled generation
- Manual trigger for on-demand generation

**Workflow:** `.github/workflows/sbom-generation.yml`

### Security Scanning

**Tools:**
- GitHub Dependency Graph (automatic)
- Dependabot Security Alerts (automatic)
- CodeQL scanning (daily)
- Semgrep SAST (weekly)

**SBOM Role:** Provides baseline for vulnerability detection

---

## References

### Internal Documentation

- [SOC2 Compliance Plan](../
.private/soc2-compliance-plan-2026-01-31.md)
- [Security Index](../INDEX.md)
- [Vendor Management Policy](../../governance/vendor-management-policy.md) *(To be created)*
- [Monthly Audit Template](../.private/monthly-audit-YYYY-MM.md) *(To be created)*

### Standards & Specifications

- [CycloneDX Specification](https://cyclonedx.org/specification/overview/)
- [SPDX Specification](https://spdx.github.io/spdx-spec/)
- [NIST 800-161 Rev. 1 (Supply Chain Risk Management)](https://csrc.nist.gov/publications/detail/sp/800-161/rev-1/final)
- [NTIA SBOM Guidelines](https://www.ntia.gov/SBOM)

### Tools

- [@cyclonedx/cyclonedx-npm](https://www.npmjs.com/package/@cyclonedx/cyclonedx-npm)
- [SPDX SBOM Generator](https://github.com/opensbom-generator/spdx-sbom-generator)
- [GitHub Dependency Graph API](https://docs.github.com/en/code-security/supply-chain-security/understanding-your-software-supply-chain/about-the-dependency-graph)

---

## Changelog

| Date | Version | Changes |
|------|---------|---------|
| 2026-01-31 | 1.0.0 | Initial SBOM framework implementation |

---

## Support

**Questions:** Review [Security Index](../INDEX.md) or contact security team
**Issues:** Create GitHub issue with `security` label
**Updates:** Submit PR to update SBOM generation script or documentation

---

**Status:** âœ… Active
**Next Review:** 2026-04-30 (Quarterly)
**Compliance:** SOC2 Type 2 - Third-Party Risk Management
