name: AI Instructions Sync & Validation

# DISABLED: Not syncing agents to GitHub at this time
# Only runs manually via workflow_dispatch
on:
  workflow_dispatch:

jobs:
  sync-and-validate:
    runs-on: ubuntu-latest
    env:
      ALLOW_MISSING_DCYFR: 'true'
      # Default ignored files are read from .github/agents/instructions/INSTRUCTIONS_CONFIG.json
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Sync AI docs
        run: npm run sync:ai

      - name: Validate instruction files
        run: node scripts/validate-instructions.mjs
        # This repo intentionally omits .github/agents/DCYFR.agent.md in some branches
        # and the validation script will ignore it if the file is marked optional.

      - name: "Optional: Validate MCP servers (non-strict)"
        run: |
          if [ -f scripts/check-mcp-servers.mjs ]; then
            node scripts/check-mcp-servers.mjs --no-auth || echo "MCP checks failed but continuing";
          else
            echo "No MCP script found, proceeding...";
          fi
